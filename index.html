<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro Graduaci√≥n 2025</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 500px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 20px;
            text-align: center;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 5px;
        }
        
        .header p {
            font-size: 14px;
            opacity: 0.9;
        }
        
        .content {
            padding: 30px 20px;
        }
        
        .step {
            display: none;
        }
        
        .step.active {
            display: block;
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #667eea;
        }
        
        input[type="date"] {
            cursor: pointer;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 30px;
        }
        
        button {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }
        
        .btn-secondary:hover {
            background: #e0e0e0;
        }
        
        .step-counter {
            text-align: center;
            color: #999;
            font-size: 12px;
            margin-bottom: 20px;
        }
        
        .student-card {
            background: #f9f9f9;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        .student-card h4 {
            margin-bottom: 10px;
            color: #333;
            font-size: 14px;
        }
        
        .companions-list {
            background: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 13px;
            margin-top: 8px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .companion-item {
            padding: 8px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .companion-item:last-child {
            border-bottom: none;
        }
        
        .add-companion {
            margin-top: 10px;
            font-size: 12px;
            color: #667eea;
            cursor: pointer;
            font-weight: 600;
        }
        
        .summary {
            background: #f0f7ff;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
        }
        
        .summary-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .summary-row:last-child {
            border-bottom: none;
        }
        
        .summary-label {
            font-weight: 600;
            color: #333;
        }
        
        .summary-value {
            color: #667eea;
            font-weight: 600;
        }
        
        .students-container {
            max-height: 500px;
            overflow-y: auto;
            margin-bottom: 20px;
            padding-right: 10px;
        }
        
        .error-message {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 13px;
        }
        
        .success-message {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 13px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéì Graduaci√≥n 2025</h1>
            <p>Sistema de Registro de Asistentes</p>
        </div>
        
        <div class="content">
            <!-- PASO 1: Informaci√≥n Inicial -->
            <div class="step active" id="step1">
                <div class="step-counter">Paso 1 de 4</div>
                <h2 style="font-size: 18px; margin-bottom: 20px;">Informaci√≥n Inicial</h2>
                
                <div class="form-group">
                    <label>Instituci√≥n Educativa *</label>
                    <select id="institucion">
                        <option value="">-- Selecciona una instituci√≥n --</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Grado *</label>
                    <select id="grado">
                        <option value="">-- Selecciona un grado --</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Secci√≥n *</label>
                    <select id="seccion">
                        <option value="">-- Selecciona una secci√≥n --</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Cantidad de Estudiantes *</label>
                    <input type="number" id="cantEstudiantes" min="1" max="50" placeholder="Ej: 5">
                </div>
                
                <div class="button-group">
                    <button class="btn-primary" onclick="irPaso2()">Continuar</button>
                </div>
            </div>
            
            <!-- PASO 2: Opci√≥n Impresi√≥n/Online -->
            <div class="step" id="step2">
                <div class="step-counter">Paso 2 de 4</div>
                <h2 style="font-size: 18px; margin-bottom: 20px;">¬øC√≥mo deseas registrar?</h2>
                
                <div style="margin-bottom: 20px;">
                    <button class="btn-primary" style="width: 100%; margin-bottom: 10px; text-align: center; padding: 20px;" onclick="descargarPlantilla()">
                        üìÑ Descargar Plantilla para Imprimir
                    </button>
                    <p style="text-align: center; font-size: 12px; color: #999; margin: 10px 0;">Imprime y llena a mano</p>
                </div>
                
                <div style="margin-bottom: 20px;">
                    <button class="btn-primary" style="width: 100%; padding: 20px;" onclick="irPaso3()">
                        üíª Continuar Registrando Online
                    </button>
                    <p style="text-align: center; font-size: 12px; color: #999; margin: 10px 0;">Registra aqu√≠ directamente</p>
                </div>
                
                <div class="button-group">
                    <button class="btn-secondary" onclick="irPaso1()">‚Üê Atr√°s</button>
                </div>
            </div>
            
            <!-- PASO 3: Fecha y Local -->
            <div class="step" id="step3">
                <div class="step-counter">Paso 3 de 4</div>
                <h2 style="font-size: 18px; margin-bottom: 20px;">Fecha y Local</h2>
                
                <div class="form-group">
                    <label>Fecha del Evento *</label>
                    <input type="date" id="fecha">
                </div>
                
                <div class="form-group">
                    <label>Local *</label>
                    <select id="local">
                        <option value="">-- Selecciona un local --</option>
                    </select>
                </div>
                
                <div class="button-group">
                    <button class="btn-secondary" onclick="irPaso2()">‚Üê Atr√°s</button>
                    <button class="btn-primary" onclick="irPaso4()">Continuar ‚Üí</button>
                </div>
            </div>
            
            <!-- PASO 4: Registro de Estudiantes -->
            <div class="step" id="step4">
                <div class="step-counter">Paso 4 de 4</div>
                <h2 style="font-size: 18px; margin-bottom: 20px;">Registrar Estudiantes</h2>
                
                <div id="mensajeError"></div>
                <div class="students-container" id="estudiantesForm"></div>
                
                <div class="button-group">
                    <button class="btn-secondary" onclick="irPaso3()">‚Üê Atr√°s</button>
                    <button class="btn-primary" onclick="enviarDatos()">‚úì Enviar Registros</button>
                </div>
            </div>
            
            <!-- CONFIRMACI√ìN -->
            <div class="step" id="step5">
                <div style="text-align: center; padding: 40px 20px;">
                    <div style="font-size: 60px; margin-bottom: 20px;">‚úÖ</div>
                    <h2 style="color: #28a745; margin-bottom: 10px;">¬°Registro Completado!</h2>
                    <p style="color: #666; margin-bottom: 20px;">Los datos se han guardado correctamente.</p>
                    
                    <div id="resumenFinal" class="summary"></div>
                    
                    <div class="button-group" style="flex-direction: column;">
                        <button class="btn-primary" onclick="imprimirResumen()" style="margin-bottom: 10px;">üñ®Ô∏è Imprimir Resumen</button>
                        <button class="btn-secondary" onclick="resetFormulario()">Nuevo Registro</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ===== CONFIGURACI√ìN PRINCIPAL =====
        const APPS_SCRIPT_URL = "https://script.googleapis.com/macros/s/AKfycbyapz75V-AlJ422MOVRjdHaZAgJshQlTwB1XlowZPiz5Yq8BrDloAISfTdgh_PLE4KX/exec";
        const SHEET_ID = "1lRQ9U0GrLkdRZOMS5Jefm5TbI1TxKrOax8ZrMekC5Us";
        
        // ===== ACTUALIZA ESTO CON TUS DATOS REALES =====
        const datosEstaticos = {
            instituciones: ['Colegio A', 'Colegio B', 'Colegio C', 'Colegio D', 'Colegio E', 'Colegio F', 'Colegio G', 'Colegio H', 'Colegio I', 'Colegio J', 'Colegio K', 'Colegio L', 'Colegio M', 'Colegio N', 'Colegio O', 'Colegio P', 'Colegio Q', 'Colegio R', 'Colegio S', 'Colegio T'],
            grados: ['1ro', '2do', '3ro', '4to', '5to', '6to'],
            secciones: ['A', 'B', 'C', 'D'],
            locales: ['SUBAU', 'LA FINCA DEL ABUELO']
        };
        
        let datosGlobales = {
            institucion: '',
            grado: '',
            seccion: '',
            fecha: '',
            local: '',
            cantEstudiantes: 0,
            estudiantes: []
        };
        
        // ===== CARGAR CONFIGURACI√ìN =====
        function cargarConfiguracion() {
            // Instituciones
            const selectInst = document.getElementById('institucion');
            datosEstaticos.instituciones.forEach(inst => {
                const option = document.createElement('option');
                option.value = inst;
                option.textContent = inst;
                selectInst.appendChild(option);
            });
            
            // Grados
            const selectGrado = document.getElementById('grado');
            datosEstaticos.grados.forEach(grado => {
                const option = document.createElement('option');
                option.value = grado;
                option.textContent = grado;
                selectGrado.appendChild(option);
            });
            
            // Secciones
            const selectSecc = document.getElementById('seccion');
            datosEstaticos.secciones.forEach(secc => {
                const option = document.createElement('option');
                option.value = secc;
                option.textContent = secc;
                selectSecc.appendChild(option);
            });
            
            // Locales
            const selectLocal = document.getElementById('local');
            datosEstaticos.locales.forEach(local => {
                const option = document.createElement('option');
                option.value = local;
                option.textContent = local;
                selectLocal.appendChild(option);
            });
            
            console.log('‚úÖ Configuraci√≥n cargada correctamente');
        }
        
        // ===== NAVEGACI√ìN ENTRE PASOS =====
        function irPaso1() {
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            document.getElementById('step1').classList.add('active');
        }
        
        function irPaso2() {
            const inst = document.getElementById('institucion').value;
            const grado = document.getElementById('grado').value;
            const secc = document.getElementById('seccion').value;
            const cant = document.getElementById('cantEstudiantes').value;
            
            if (!inst || !grado || !secc || !cant) {
                alert('Por favor completa todos los campos');
                return;
            }
            
            datosGlobales.institucion = inst;
            datosGlobales.grado = grado;
            datosGlobales.seccion = secc;
            datosGlobales.cantEstudiantes = parseInt(cant);
            
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            document.getElementById('step2').classList.add('active');
        }
        
        function irPaso3() {
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            document.getElementById('step3').classList.add('active');
        }
        
        function irPaso4() {
            const fecha = document.getElementById('fecha').value;
            const local = document.getElementById('local').value;
            
            if (!fecha || !local) {
                alert('Por favor completa fecha y local');
                return;
            }
            
            datosGlobales.fecha = fecha;
            datosGlobales.local = local;
            
            generarFormularioEstudiantes();
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            document.getElementById('step4').classList.add('active');
        }
        
        // ===== GENERAR FORMULARIO DE ESTUDIANTES =====
        function generarFormularioEstudiantes() {
            const container = document.getElementById('estudiantesForm');
            container.innerHTML = '';
            
            for (let i = 0; i < datosGlobales.cantEstudiantes; i++) {
                const estudiante = document.createElement('div');
                estudiante.className = 'student-card';
                estudiante.innerHTML = `
                    <h4>Estudiante ${i + 1}</h4>
                    
                    <div class="form-group">
                        <label>Apellidos *</label>
                        <input type="text" class="apellido-est" placeholder="Apellidos" required>
                    </div>
                    
                    <div class="form-group">
                        <label>Nombres *</label>
                        <input type="text" class="nombre-est" placeholder="Nombres" required>
                    </div>
                    
                    <div class="form-group">
                        <label>N√∫mero de Mesa (m√°x 20)</label>
                        <input type="number" class="mesa-est" min="1" max="20" placeholder="1-20">
                    </div>
                    
                    <div>
                        <label style="font-weight: 600; margin-bottom: 10px;">Acompa√±antes</label>
                        <div class="companions-list" data-student="${i}"></div>
                        <div class="add-companion" onclick="agregarAcompa√±ante(${i})">+ Agregar acompa√±ante</div>
                    </div>
                `;
                container.appendChild(estudiante);
            }
        }
        
        // ===== ACOMPA√ëANTES =====
        function agregarAcompa√±ante(indexEstudiante) {
            const container = document.querySelector(`.companions-list[data-student="${indexEstudiante}"]`);
            const indexAcomp = container.children.length;
            
            if (indexAcomp >= 15) {
                alert('M√°ximo 15 acompa√±antes por estudiante');
                return;
            }
            
            const item = document.createElement('div');
            item.className = 'companion-item';
            item.innerHTML = `
                <div style="display: flex; gap: 5px; margin-bottom: 5px;">
                    <input type="text" placeholder="Nombre" class="acomp-nombre" data-student="${indexEstudiante}" data-index="${indexAcomp}" style="flex: 1; padding: 8px; border: 2px solid #e0e0e0; border-radius: 5px;">
                    <input type="text" placeholder="Apellido" class="acomp-apellido" data-student="${indexEstudiante}" data-index="${indexAcomp}" style="flex: 1; padding: 8px; border: 2px solid #e0e0e0; border-radius: 5px;">
                </div>
                <button onclick="eliminarAcompa√±ante(${indexEstudiante}, ${indexAcomp})" style="width: 100%; padding: 5px; background: #ff6b6b; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 11px;">Eliminar</button>
            `;
            container.appendChild(item);
        }
        
        function eliminarAcompa√±ante(indexEstudiante, indexAcomp) {
            const container = document.querySelector(`.companions-list[data-student="${indexEstudiante}"]`);
            if (container.children[indexAcomp]) {
                container.children[indexAcomp].remove();
            }
        }
        
        // ===== ENVIAR DATOS A GOOGLE SHEETS =====
        async function enviarDatos() {
            const mensajeError = document.getElementById('mensajeError');
            mensajeError.innerHTML = '';
            
            const estudiantes = [];
            const cards = document.querySelectorAll('.student-card');
            
            // Validar y recopilar datos
            cards.forEach((card, i) => {
                const apellido = card.querySelector('.apellido-est').value.trim();
                const nombre = card.querySelector('.nombre-est').value.trim();
                const mesa = card.querySelector('.mesa-est').value || '';
                
                if (!apellido || !nombre) {
                    alert(`Por favor completa nombre y apellido del estudiante ${i + 1}`);
                    return;
                }
                
                const acompa√±antes = [];
                const acompInputs = card.querySelectorAll('.companion-item');
                acompInputs.forEach(input => {
                    const nombre = input.querySelector('.acomp-nombre').value.trim();
                    const apellido = input.querySelector('.acomp-apellido').value.trim();
                    if (nombre || apellido) {
                        acompa√±antes.push({ nombre, apellido });
                    }
                });
                
                estudiantes.push({
                    apellido,
                    nombre,
                    mesa,
                    acompa√±antes
                });
            });
            
            if (estudiantes.length === 0) return;
            
            // Enviar cada estudiante
            try {
                for (const est of estudiantes) {
                    const payload = {
                        institucion: datosGlobales.institucion,
                        grado: datosGlobales.grado,
                        seccion: datosGlobales.seccion,
                        fecha: datosGlobales.fecha,
                        local: datosGlobales.local,
                        apellidoEstudiante: est.apellido,
                        nombreEstudiante: est.nombre,
                        numMesa: est.mesa,
                        acompa√±antes: est.acompa√±antes
                    };
                    
                    const response = await fetch(APPS_SCRIPT_URL, {
                        method: 'POST',
                        body: JSON.stringify(payload)
                    });
                    
                    const result = await response.json();
                    if (!result.success) {
                        throw new Error(result.message);
                    }
                }
                
                datosGlobales.estudiantes = estudiantes;
                mostrarConfirmacion();
                
            } catch (error) {
                console.error('Error:', error);
                mensajeError.innerHTML = `<div class="error-message">‚ùå Error al guardar: ${error.message}</div>`;
            }
        }
        
        // ===== MOSTRAR CONFIRMACI√ìN =====
        function mostrarConfirmacion() {
            const resumen = document.getElementById('resumenFinal');
            let html = `
                <div class="summary-row">
                    <span class="summary-label">Instituci√≥n:</span>
                    <span class="summary-value">${datosGlobales.institucion}</span>
                </div>
                <div class="summary-row">
                    <span class="summary-label">Grado / Secci√≥n:</span>
                    <span class="summary-value">${datosGlobales.grado} - ${datosGlobales.seccion}</span>
                </div>
                <div class="summary-row">
                    <span class="summary-label">Fecha:</span>
                    <span class="summary-value">${datosGlobales.fecha}</span>
                </div>
                <div class="summary-row">
                    <span class="summary-label">Local:</span>
                    <span class="summary-value">${datosGlobales.local}</span>
                </div>
                <div class="summary-row">
                    <span class="summary-label">Estudiantes Registrados:</span>
                    <span class="summary-value">${datosGlobales.estudiantes.length}</span>
                </div>
            `;
            resumen.innerHTML = html;
            
            document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
            document.getElementById('step5').classList.add('active');
        }
        
        // ===== DESCARGAR PLANTILLA =====
        function descargarPlantilla() {
            const contenido = `GRADUACI√ìN 2025 - PLANTILLA DE REGISTRO
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

INSTITUCI√ìN: ${datosGlobales.institucion}
GRADO: ${datosGlobales.grado}
SECCI√ìN: ${datosGlobales.seccion}
CANTIDAD DE ESTUDIANTES: ${datosGlobales.cantEstudiantes}

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

INSTRUCCIONES:
1. Llena los datos a mano
2. Digitaliza despu√©s o ingresa manualmente en el formulario online

‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

${Array.from({length: datosGlobales.cantEstudiantes}, (_, i) => `
ESTUDIANTE ${i + 1}
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Apellidos: _____________________________________________
Nombres: _______________________________________________
N√∫mero de Mesa: ___________

ACOMPA√ëANTES (M√°ximo 15):
1. Apellido: ________________________  Nombre: _____________________
2. Apellido: ________________________  Nombre: _____________________
3. Apellido: ________________________  Nombre: _____________________
4. Apellido: ________________________  Nombre: _____________________
5. Apellido: ________________________  Nombre: _____________________
6. Apellido: ________________________  Nombre: _____________________
7. Apellido: ________________________  Nombre: _____________________
8. Apellido: ________________________  Nombre: _____________________
9. Apellido: ________________________  Nombre: _____________________
10. Apellido: ________________________  Nombre: _____________________
11. Apellido: ________________________  Nombre: _____________________
12. Apellido: ________________________  Nombre: _____________________
13. Apellido: ________________________  Nombre: _____________________
14. Apellido: ________________________  Nombre: _____________________
15. Apellido: ________________________  Nombre: _____________________

`).join('\n‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n')}

FIN DE LA PLANTILLA
‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê`;
            
            const blob = new Blob([contenido], {type: 'text/plain;charset=utf-8'});
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `Plantilla_${datosGlobales.institucion}_${datosGlobales.grado}${datosGlobales.seccion}.txt`;
            link.click();
        }
        
        // ===== IMPRIMIR RESUMEN =====
        function imprimirResumen() {
            const ventana = window.open('', '', 'width=900,height=700');
            ventana.document.write(`
                <!DOCTYPE html>
                <html>
                <head>
                    <title>Resumen - Graduaci√≥n 2025</title>
                    <style>
                        body { font-family: Arial, sans-serif; padding: 20px; }
                        .header { text-align: center; margin-bottom: 30px; border-bottom: 3px solid #667eea; padding-bottom: 20px; }
                        .header h1 { margin: 0; color: #333; font-size: 24px; }
                        .header p { margin: 5px 0; color: #666; }
                        .data { margin: 20px 0; padding: 15px; background: #f5f5f5; border-radius: 5px; }
                        .data-row { display: flex; justify-content: space-between; margin: 10px 0; padding: 5px 0; border-bottom: 1px solid #ddd; }
                        .data-label { font-weight: bold; color: #333; }
                        .data-value { color: #667eea; font-weight: bold; }
                        .estudiantes { margin-top: 30px; }
                        .estudiante-item { margin: 15px 0; padding: 12px; border-left: 4px solid #667eea; background: #f9f9f9; page-break-inside: avoid; }
                        .acompa√±antes { margin-top: 10px; font-size: 13px; padding-left: 15px; }
                        .acomp-item { margin: 5px 0; }
                        h3 { color: #667eea; margin-top: 20px; }
                        @media print {
                            body { margin: 0; padding: 10px; }
                        }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>üéì Graduaci√≥n 2025</h1>
                        <p>Resumen de Registro Completado</p>
                    </div>
                    
                    <div class="data">
                        <div class="data-row">
                            <span class="data-label">Instituci√≥n:</span>
                            <span class="data-value">${datosGlobales.institucion}</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label">Grado:</span>
                            <span class="data-value">${datosGlobales.grado}</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label">Secci√≥n:</span>
                            <span class="data-value">${datosGlobales.seccion}</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label">Fecha:</span>
                            <span class="data-value">${datosGlobales.fecha}</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label">Local:</span>
                            <span class="data-value">${datosGlobales.local}</span>
                        </div>
                        <div class="data-row">
                            <span class="data-label">Total de Estudiantes:</span>
                            <span class="data-value">${datosGlobales.estudiantes.length}</span>
                        </div>
                    </div>
                    
                    <h3>üìã Detalle de Registros</h3>
                    <div class="estudiantes">
                        ${datosGlobales.estudiantes.map((est, idx) => `
                            <div class="estudiante-item">
                                <strong>${idx + 1}. ${est.apellido}, ${est.nombre}</strong>
                                <div style="margin-top: 5px; color: #666;">Mesa: ${est.mesa || 'No asignada'}</div>
                                ${est.acompa√±antes.length > 0 ? `
                                    <div class="acompa√±antes">
                                        <strong>Acompa√±antes (${est.acompa√±antes.length}):</strong>
                                        ${est.acompa√±antes.map(a => `<div class="acomp-item">‚Ä¢ ${a.apellido}, ${a.nombre}</div>`).join('')}
                                    </div>
                                ` : '<div class="acompa√±antes"><em>Sin acompa√±antes</em></div>'}
                            </div>
                        `).join('')}
                    </div>
                    
                    <div style="margin-top: 40px; text-align: center; color: #999; font-size: 12px;">
                        <p>Documento generado autom√°ticamente - Graduaci√≥n 2025</p>
                        <p>Fecha de impresi√≥n: ${new Date().toLocaleDateString('es-ES')}</p>
                    </div>
                    
                    <script>
                        window.print();
                    </script>
                </body>
                </html>
            `);
            ventana.document.close();
        }
        
        // ===== RESETEAR FORMULARIO =====
        function resetFormulario() {
            datosGlobales = {
                institucion: '',
                grado: '',
                seccion: '',
                fecha: '',
                local: '',
                cantEstudiantes: 0,
                estudiantes: []
            };
            
            document.getElementById('institucion').value = '';
            document.getElementById('grado').value = '';
            document.getElementById('seccion').value = '';
            document.getElementById('cantEstudiantes').value = '';
            document.getElementById('fecha').value = '';
            document.getElementById('local').value = '';
            document.getElementById('mensajeError').innerHTML = '';
            
            irPaso1();
        }
        
        // ===== INICIALIZAR AL CARGAR =====
        window.addEventListener('load', cargarConfiguracion);
    </script>
</body>
</html>
